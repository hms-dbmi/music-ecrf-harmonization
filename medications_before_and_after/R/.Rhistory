filter(!Variable...Field.Name %in% c('med_na', 'medhosp_type', 'medhosp_name', 'medhosp_start_dt', 'medhosp_ae', 'medhosp_ae_num'))
datadict <- read.csv('../../common_ref/MUSIC_DataDictionary_V3_4Dec20_final version_clean_0.csv') %>%
filter(Form.Name == 'additional_medications_during_hospitalization') %>%
select(Variable...Field.Name, Choices..Calculations..OR.Slider.Labels) %>%
filter(!Variable...Field.Name %in% c('med_na', 'medhosp[[:digit:]]_type', 'medhosp_name', 'medhosp_start_dt', 'medhosp_ae', 'medhosp_ae_num'))
datadict <- read.csv('../../common_ref/MUSIC_DataDictionary_V3_4Dec20_final version_clean_0.csv') %>%
filter(Form.Name == 'additional_medications_during_hospitalization') %>%
select(Variable...Field.Name, Choices..Calculations..OR.Slider.Labels)
datadict <- datadict %>%
separate(Variable...Field.Name, c('a', 'b', 'c'), sep = '_') %>%
mutate(a = str_replace(a, '[[:digit:]]+', '')) %>%
unique()
dd <- datadict %>%
filter(!b %in% c('med_na', 'type', 'name', 'start', 'ae'))
View(dd)
dd <- datadict %>%
filter(!b %in% c('na', 'type', 'name', 'start', 'ae')) %>%
separate_rows(Choices..Calculations..OR.Slider.Labels, sep = '\\|') %>%
mutate(ECRF_CODE = str_replace(Choices..Calculations..OR.Slider.Labels, ',.*$', ''),
ECRF_CODE = str_trim(ECRF_CODE),
ECRF_CODE = fix_code_formatting(ECRF_CODE)) %>%
select(-Choices..Calculations..OR.Slider.Labels)
dd <- datadict %>%
filter(!b %in% c('na', 'type', 'name', 'start', 'ae')) %>%
separate_rows(Choices..Calculations..OR.Slider.Labels, sep = '\\|') %>%
mutate(ECRF_CODE = str_replace(Choices..Calculations..OR.Slider.Labels, ',.*$', ''),
ECRF_CODE = str_trim(ECRF_CODE),
ECRF_CODE = fix_code_formatting(ECRF_CODE)) %>%
select(-Choices..Calculations..OR.Slider.Labels)
datadict <- datadict %>%
separate(Variable...Field.Name, c('a', 'b', 'c'), sep = '_') %>%
mutate(a = str_replace(a, '[[:digit:]]+', '')) %>%
unique() %>%
filter(!b %in% c('na', 'type', 'name', 'start', 'ae')) %>%
separate_rows(Choices..Calculations..OR.Slider.Labels, sep = '\\|') %>%
mutate(ECRF_CODE = str_replace(Choices..Calculations..OR.Slider.Labels, ',.*$', ''),
ECRF_CODE = str_trim(ECRF_CODE),
ECRF_CODE = fix_code_formatting(ECRF_CODE)) %>%
select(-Choices..Calculations..OR.Slider.Labels)
datadict <- read.csv('../../common_ref/MUSIC_DataDictionary_V3_4Dec20_final version_clean_0.csv') %>%
filter(Form.Name == 'additional_medications_during_hospitalization') %>%
select(Variable...Field.Name, Choices..Calculations..OR.Slider.Labels) %>%
separate(Variable...Field.Name, c('a', 'b', 'c'), sep = '_') %>%
mutate(a = str_replace(a, '[[:digit:]]+', '')) %>%
unique() %>%
filter(!b %in% c('na', 'type', 'name', 'start', 'ae')) %>%
separate_rows(Choices..Calculations..OR.Slider.Labels, sep = '\\|') %>%
mutate(ECRF_CODE = str_replace(Choices..Calculations..OR.Slider.Labels, ',.*$', ''),
ECRF_CODE = str_trim(ECRF_CODE),
ECRF_CODE = fix_code_formatting(ECRF_CODE)) %>%
select(-Choices..Calculations..OR.Slider.Labels)
bch_med_concept_summary <- read_csv('../../medications_before_and_after/data/bch_med_concept_summary_toReview.csv')
bch_med_concept_summary <- left_join(bch_med_concept_summary, datadict, by = 'ECRF_CODE')
df <- left_join(df, bch_med_concept_summary %>% select(ECRF_CODE, CONCEPT_CD, Variable...Field.Name), by = 'CONCEPT_CD')
View(bch_med_concept_summary)
datadict <- read.csv('../../common_ref/MUSIC_DataDictionary_V3_4Dec20_final version_clean_0.csv') %>%
filter(Form.Name == 'additional_medications_during_hospitalization') %>%
select(Variable...Field.Name, Choices..Calculations..OR.Slider.Labels) %>%
separate(Variable...Field.Name, c('a', 'b', 'c'), sep = '_') %>%
filter(!b %in% c('na', 'type', 'name', 'start', 'ae')) %>%
mutate(a = str_replace(a, '[[:digit:]]+', ''),
Variable...Field.Name = paste0(a, 'X', '_', b, '_', c)) %>%
unique() %>%
separate_rows(Choices..Calculations..OR.Slider.Labels, sep = '\\|') %>%
mutate(ECRF_CODE = str_replace(Choices..Calculations..OR.Slider.Labels, ',.*$', ''),
ECRF_CODE = str_trim(ECRF_CODE),
ECRF_CODE = fix_code_formatting(ECRF_CODE)) %>%
select(-Choices..Calculations..OR.Slider.Labels)
bch_med_concept_summary <- read_csv('../../medications_before_and_after/data/bch_med_concept_summary_toReview.csv')
bch_med_concept_summary <- left_join(bch_med_concept_summary, datadict, by = 'ECRF_CODE')
df <- left_join(df, bch_med_concept_summary %>% select(ECRF_CODE, CONCEPT_CD, Variable...Field.Name), by = 'CONCEPT_CD')
View(df)
df2 <- df %>%
mutate(date = dmy(sapply(strsplit( as.character(START_DATE), " "), '[', 1)),
time = sapply(strsplit( as.character(START_DATE), " "), '[', 2),
DISCHARGE_DATE = dmy(sapply(strsplit( as.character(END_DATE), " "), '[', 1)),
ADMISSION_DATE = dmy(ADMISSIONDATE),
days_after_admission = date - ADMISSION_DATE,
days_after_discharge = date - DISCHARGE_DATE)
View(df2)
df3 <- df %>%
mutate(date = dmy(sapply(strsplit( as.character(START_DATE), " "), '[', 1)),
time = sapply(strsplit( as.character(START_DATE), " "), '[', 2),
DISCHARGE_DATE = dmy(sapply(strsplit( as.character(END_DATE), " "), '[', 1)),
ADMISSION_DATE = dmy(ADMISSIONDATE),
days_after_admission = date - ADMISSION_DATE,
days_after_discharge = date - DISCHARGE_DATE) %>%
rowwise
View(df3)
?rowwise
df3 <- df %>%
mutate(date = dmy(sapply(strsplit( as.character(START_DATE), " "), '[', 1)),
time = sapply(strsplit( as.character(START_DATE), " "), '[', 2),
DISCHARGE_DATE = dmy(sapply(strsplit( as.character(END_DATE), " "), '[', 1)),
ADMISSION_DATE = dmy(ADMISSIONDATE),
days_after_admission = date - ADMISSION_DATE,
days_after_discharge = date - DISCHARGE_DATE) %>%
filter(days_after_admission >= 0,
days_after_discharge <= 0)
df2 <- df %>%
mutate(date = dmy(sapply(strsplit( as.character(START_DATE), " "), '[', 1)),
time = sapply(strsplit( as.character(START_DATE), " "), '[', 2),
DISCHARGE_DATE = dmy(sapply(strsplit( as.character(END_DATE), " "), '[', 1)),
ADMISSION_DATE = dmy(ADMISSIONDATE),
days_after_admission = date - ADMISSION_DATE,
days_after_discharge = date - DISCHARGE_DATE) %>%
filter(days_after_admission >= 0,
days_after_discharge <= 0)
View(df2)
df <- df %>%
mutate(date = dmy(sapply(strsplit( as.character(START_DATE), " "), '[', 1)),
time = sapply(strsplit( as.character(START_DATE), " "), '[', 2),
DISCHARGE_DATE = dmy(sapply(strsplit( as.character(END_DATE), " "), '[', 1)),
ADMISSION_DATE = dmy(ADMISSIONDATE),
days_after_admission = date - ADMISSION_DATE,
days_after_discharge = date - DISCHARGE_DATE) %>%
filter(days_after_admission >= 0,
days_after_discharge <= 0)
df <- read.csv('../../medications_before_and_after/local_ref/agg40_music_meds_filtered.csv')
datadict <- read.csv('../../common_ref/MUSIC_DataDictionary_V3_4Dec20_final version_clean_0.csv') %>%
filter(Form.Name == 'additional_medications_during_hospitalization') %>%
select(Variable...Field.Name, Choices..Calculations..OR.Slider.Labels) %>%
separate(Variable...Field.Name, c('a', 'b', 'c'), sep = '_') %>%
filter(!b %in% c('na', 'type', 'name', 'start', 'ae')) %>%
mutate(a = str_replace(a, '[[:digit:]]+', ''),
Variable...Field.Name = paste0(a, 'X', '_', b, '_', c)) %>%
unique() %>%
separate_rows(Choices..Calculations..OR.Slider.Labels, sep = '\\|') %>%
mutate(ECRF_CODE = str_replace(Choices..Calculations..OR.Slider.Labels, ',.*$', ''),
ECRF_CODE = str_trim(ECRF_CODE),
ECRF_CODE = fix_code_formatting(ECRF_CODE)) %>%
select(-Choices..Calculations..OR.Slider.Labels)
datadict <- read.csv('../../common_ref/MUSIC_DataDictionary_V3_4Dec20_final version_clean_0.csv')
View(datadict)
View(datadict)
datadict <- read.csv('../../common_ref/MUSIC_DataDictionary_V3_4Dec20_final version_clean_0.csv') %>%
filter(Form.Name == 'additional_medications_during_hospitalization')
library(tidyverse)
library(lubridate)
df <- read.csv('../../medications_before_and_after/local_ref/agg40_music_meds_filtered.csv')
datadict <- read.csv('../../common_ref/MUSIC_DataDictionary_V3_4Dec20_final version_clean_0.csv') %>%
filter(Form.Name == 'additional_medications_during_hospitalization') %>%
select(Variable...Field.Name, Choices..Calculations..OR.Slider.Labels) %>%
separate(Variable...Field.Name, c('a', 'b', 'c'), sep = '_') %>%
filter(!b %in% c('na', 'type', 'name', 'start', 'ae')) %>%
mutate(a = str_replace(a, '[[:digit:]]+', ''),
Variable...Field.Name = paste0(a, 'X', '_', b, '_', c)) %>%
unique() %>%
separate_rows(Choices..Calculations..OR.Slider.Labels, sep = '\\|') %>%
mutate(ECRF_CODE = str_replace(Choices..Calculations..OR.Slider.Labels, ',.*$', ''),
ECRF_CODE = str_trim(ECRF_CODE),
ECRF_CODE = fix_code_formatting(ECRF_CODE)) %>%
select(-Choices..Calculations..OR.Slider.Labels)
bch_med_concept_summary <- read_csv('../../medications_before_and_after/data/bch_med_concept_summary_toReview.csv')
bch_med_concept_summary <- left_join(bch_med_concept_summary, datadict, by = 'ECRF_CODE')
df <- left_join(df, bch_med_concept_summary %>% select(ECRF_CODE, CONCEPT_CD, Variable...Field.Name), by = 'CONCEPT_CD')
df <- df %>%
mutate(date = dmy(sapply(strsplit( as.character(START_DATE), " "), '[', 1)),
time = sapply(strsplit( as.character(START_DATE), " "), '[', 2),
DISCHARGE_DATE = dmy(sapply(strsplit( as.character(END_DATE), " "), '[', 1)),
ADMISSION_DATE = dmy(ADMISSIONDATE),
days_after_admission = date - ADMISSION_DATE,
days_after_discharge = date - DISCHARGE_DATE) %>%
filter(days_after_admission >= 0,
days_after_discharge <= 0)
df2 <- df %>%
group_by(PATIENT_NUM) %>%
select(-START_DATE, -END_DATE, -date, -time, -days_after_admission, -days_after_discharge) %>%
unique()
View(df2)
df2 <- df %>%
group_by(PATIENT_NUM) %>%
select(-START_DATE, -END_DATE, -days_after_admission, -days_after_discharge) %>%
unique()
df2 <- df %>%
group_by(PATIENT_NUM) %>%
select(-START_DATE, -END_DATE, -days_after_admission, -days_after_discharge) %>%
unique() %>%
mutate(redcap_repeat_instance = row_number()) %>%
mutate(medhospX_type = str_replace(str_replace(ECRF_CODE, '\\...', ''), '^0', ''))
?lubridate
hms(df2$time[1])
df2$time[1]
df2 <- df %>%
group_by(PATIENT_NUM) %>%
select(-START_DATE, -END_DATE, -days_after_admission, -days_after_discharge) %>%
unique() %>%
mutate(time = hms(time)) %>%
arrange(date, time) %>%
mutate(redcap_repeat_instance = row_number()) %>%
mutate(medhospX_type = str_replace(str_replace(ECRF_CODE, '\\...', ''), '^0', ''))
View(df2)
df2 <- df %>%
group_by(PATIENT_NUM) %>%
select(-START_DATE, -END_DATE, -days_after_admission, -days_after_discharge) %>%
unique() %>%
mutate(time = hms(time)) %>%
group_by(PATIENT_NUM, ECRF_CODE, date, time) %>%
filter(first(date), first(time))
rlang::last_error()
df2 <- df %>%
group_by(PATIENT_NUM) %>%
select(-START_DATE, -END_DATE, -days_after_admission, -days_after_discharge) %>%
unique() %>%
mutate(time = hms(time)) %>%
group_by(PATIENT_NUM, ECRF_CODE, date, time) %>%
filter(date = min(date),
time = min(time))
df2 <- df %>%
group_by(PATIENT_NUM) %>%
select(-START_DATE, -END_DATE, -days_after_admission, -days_after_discharge) %>%
unique() %>%
mutate(time = hms(time)) %>%
group_by(PATIENT_NUM, ECRF_CODE, date, time) %>%
filter(date == min(date),
time == min(time))
View(df2)
df2 <- df %>%
group_by(PATIENT_NUM) %>%
select(-START_DATE, -END_DATE, -days_after_admission, -days_after_discharge) %>%
unique() %>%
mutate(time = hms(time)) %>%
group_by(PATIENT_NUM, ECRF_CODE) %>%
summarise(date = first(date))
View(df2)
df2 <- df %>%
group_by(PATIENT_NUM) %>%
select(-START_DATE, -END_DATE, -days_after_admission, -days_after_discharge) %>%
unique() %>%
mutate(datetime = ymdhms(time)) %>%
group_by(PATIENT_NUM, ECRF_CODE) %>%
summarise(datetime = first(datetime))
df2 <- df %>%
group_by(PATIENT_NUM) %>%
select(-START_DATE, -END_DATE, -days_after_admission, -days_after_discharge) %>%
unique() %>%
mutate(datetime = ymd_hms(time)) %>%
group_by(PATIENT_NUM, ECRF_CODE) %>%
summarise(datetime = first(datetime))
df2 <- df %>%
group_by(PATIENT_NUM) %>%
select(-START_DATE, -END_DATE, -days_after_admission, -days_after_discharge) %>%
unique() %>%
mutate(datetime = paste0(date, -, time),
df2 <- df %>%
group_by(PATIENT_NUM) %>%
select(-START_DATE, -END_DATE, -days_after_admission, -days_after_discharge) %>%
unique() %>%
mutate(datetime = paste0(date, '-', time),
datetime = ymd_hms(datetime)) %>%
group_by(PATIENT_NUM, ECRF_CODE) %>%
summarise(datetime = first(datetime))
df %>% filter(PATIENT_NUM == "A75C4588-0FEA-2EC3-E053-DC90240ABE72")
df %>% filter(PATIENT_NUM == "A75C4588-0FEA-2EC3-E053-DC90240ABE72", ECRF_CODE == '02.09')
df %>% filter(PATIENT_NUM == "A75C4588-0FEA-2EC3-E053-DC90240ABE72", ECRF_CODE == '02.09') %>% unique()
df %>% filter(PATIENT_NUM == "A75C4588-0FEA-2EC3-E053-DC90240ABE72", ECRF_CODE == '02.09') %>% pull(START_DATE) %>% unique()
df %>% filter(PATIENT_NUM == "A75C4588-0FEA-2EC3-E053-DC90240ABE72", ECRF_CODE == '03.15') %>% pull(START_DATE) %>% unique()
df %>% filter(PATIENT_NUM == "A75C4588-0FEA-2EC3-E053-DC90240ABE72", ECRF_CODE == '07.2') %>% pull(START_DATE) %>% unique()
df %>% filter(PATIENT_NUM == "A75C4588-0FEA-2EC3-E053-DC90240ABE72", ECRF_CODE == '07.22') %>% pull(START_DATE) %>% unique()
df %>% filter(PATIENT_NUM == "A75C4588-0FEA-2EC3-E053-DC90240ABE72", ECRF_CODE == '07.02') %>% pull(START_DATE) %>% unique()
df2 <- df %>%
group_by(PATIENT_NUM) %>%
select(-START_DATE, -END_DATE, -days_after_admission, -days_after_discharge) %>%
unique() %>%
mutate(datetime = paste0(date, '-', time),
datetime = ymd_hms(datetime)) %>%
group_by(PATIENT_NUM, ECRF_CODE) %>%
summarise(datetime = min(datetime))
df %>% filter(PATIENT_NUM == "A75C4588-0FEA-2EC3-E053-DC90240ABE72", ECRF_CODE == '07.02') %>% pull(START_DATE) %>% unique()
colnames(df)
df2 <- df %>%
group_by(PATIENT_NUM) %>%
mutate(datetime = paste0(date, '-', time),
datetime = ymd_hms(datetime),
medhospX_type = str_replace(str_replace(ECRF_CODE, '\\...', ''), '^0', '')) %>%
group_by(PATIENT_NUM, ECRF_CODE) %>%
summarise(datetime = min(datetime)) %>%
ungroup() %>%
group_by(PATIENT_NUM) %>%
arrange(as.numeric(medhospX_type)) %>%
mutate(redcap_repeat_instance = row_number())
df2 <- df %>%
group_by(PATIENT_NUM) %>%
mutate(datetime = paste0(date, '-', time),
datetime = ymd_hms(datetime),
medhospX_type = str_replace(str_replace(ECRF_CODE, '\\...', ''), '^0', ''))
df2 <- df %>%
group_by(PATIENT_NUM) %>%
mutate(datetime = paste0(date, '-', time),
datetime = ymd_hms(datetime),
medhospX_type = as.numeric(str_replace(str_replace(ECRF_CODE, '\\...', ''), '^0', '')))
df2 <- df %>%
group_by(PATIENT_NUM) %>%
mutate(datetime = paste0(date, '-', time),
datetime = ymd_hms(datetime),
medhospX_type = as.numeric(str_replace(str_replace(ECRF_CODE, '\\...', ''), '^0', ''))) %>%
group_by(PATIENT_NUM, ECRF_CODE) %>%
summarise(datetime = min(datetime)) %>%
ungroup() %>%
group_by(PATIENT_NUM) %>%
arrange(medhospX_type) %>%
mutate(redcap_repeat_instance = row_number())
group_by(PATIENT_NUM) %>%
arrange(medhospX_type) %>%
mutate(redcap_repeat_instance = row_number())
df2 <- df %>%
group_by(PATIENT_NUM) %>%
mutate(datetime = paste0(date, '-', time),
datetime = ymd_hms(datetime)) %>%
group_by(PATIENT_NUM, ECRF_CODE) %>%
summarise(datetime = min(datetime)) %>%
ungroup() %>%
mutate(medhospX_type = as.numeric(str_replace(str_replace(ECRF_CODE, '\\...', ''), '^0', ''))) %>%
group_by(PATIENT_NUM) %>%
arrange(medhospX_type) %>%
mutate(redcap_repeat_instance = row_number())
parse_date_time(df2$datetime[1], "mdy")
parse_date_time(df2$datetime[1], "ymd_hms")
parse_date_time(df2$datetime[1], "ymd_HMS")
parse_date_time(df2$datetime[1], "ymd_H")
format(df2$datetime[1], "mdy")
format(df2$datetime[1], "%m%d%y")
format(df2$datetime[1], "%m%d%Y")
format(df2$datetime[1], "%m-%d-%Y")
df2 <- df %>%
group_by(PATIENT_NUM) %>%
mutate(datetime = paste0(date, '-', time),
datetime = ymd_hms(datetime)) %>%
group_by(PATIENT_NUM, ECRF_CODE) %>%
summarise(datetime = min(datetime)) %>%
ungroup() %>%
mutate(medhospX_type = as.numeric(str_replace(str_replace(ECRF_CODE, '\\...', ''), '^0', ''))) %>%
group_by(PATIENT_NUM) %>%
arrange(medhospX_type) %>%
mutate(redcap_repeat_instance = row_number())  %>%
ungroup() %>%
mutate(medhospX_start_dt = format(datetime, "%m-%d-%Y"))
colnames(df)
df2 <- df %>%
group_by(PATIENT_NUM) %>%
mutate(datetime = paste0(date, '-', time),
datetime = ymd_hms(datetime)) %>%
group_by(PATIENT_NUM, ECRF_CODE) %>%
summarise(datetime = min(datetime),
Variable...Field.Name = first(Variable...Field.Name)) %>%
ungroup() %>%
mutate(medhospX_type = as.numeric(str_replace(str_replace(ECRF_CODE, '\\...', ''), '^0', ''))) %>%
group_by(PATIENT_NUM) %>%
arrange(medhospX_type) %>%
mutate(redcap_repeat_instance = row_number())  %>%
ungroup() %>%
mutate(medhospX_start_dt = format(datetime, "%m-%d-%Y"))
df3 <= df2 %>%
mutate(Variable...Field.Name = str_replace(Variable...Field.Name, 'X', redcap_repeat_instance))
df3 <= df2 %>%
mutate(Variable...Field.Name = str_replace(Variable...Field.Name, 'X', as.character(redcap_repeat_instance)))
str_replace(df2$Variable...Field.Name[1:10], 'X', as.character(df2$redcap_repeat_instance)[1:10])
df3 <= df2 %>%
mutate(redcap_repeat_instance = as.character(redcap_repeat_instance),
Variable...Field.Name = str_replace(Variable...Field.Name, 'X', redcap_repeat_instance))
df3 <-df2 %>%
mutate(Variable...Field.Name = str_replace(Variable...Field.Name, 'X', as.character(redcap_repeat_instance)))
View(df3)
df2 <- df %>%
group_by(PATIENT_NUM) %>%
mutate(datetime = paste0(date, '-', time),
datetime = ymd_hms(datetime)) %>%
group_by(PATIENT_NUM, ECRF_CODE) %>%
summarise(datetime = min(datetime),
Variable...Field.Name = first(Variable...Field.Name)) %>%
ungroup() %>%
mutate(medhospX_type = as.numeric(str_replace(str_replace(ECRF_CODE, '\\...', ''), '^0', ''))) %>%
group_by(PATIENT_NUM, medhospX_type) %>%
arrange(as.numeric(ECRF_CODE)) %>%
mutate(redcap_repeat_instance = row_number())  %>%
ungroup() %>%
mutate(medhospX_start_dt = format(datetime, "%m-%d-%Y"))
df3 <- df2 %>%
mutate(Variable...Field.Name = str_replace(Variable...Field.Name, 'X', as.character(redcap_repeat_instance)))
colnames(df3)
?pivot_wider
out <- pivot_wider(df3,
id_cols = c(PATIENT_NUM, medhospX_type, medhospX_start_dt),
names_from = Variable...Field.Name,
values_from = ECRF_CODE,
values_fill = NA)
View(out)
# pivot medhospX_start_dt
out2 <- out %>%
mutate(medhospX_start_dt_names = str_replace('medhospX_start_dt', 'X', redcap_repeat_instance)) %>%
pivot_wider(
id_cols = c(PATIENT_NUM, medhospX_type, redcap_repeat_instance),
names_from = medhospX_start_dt_names,
values_from = medhospX_start_dt,
values_fill = NA)
# pivot variable names
out <- pivot_wider(df3,
id_cols = c(PATIENT_NUM, medhospX_type, medhospX_start_dt, redcap_repeat_instance),
names_from = Variable...Field.Name,
values_from = ECRF_CODE,
values_fill = NA)
# pivot variable names
out <- pivot_wider(df3,
id_cols = c(PATIENT_NUM, medhospX_type, medhospX_start_dt, redcap_repeat_instance),
names_from = Variable...Field.Name,
values_from = ECRF_CODE,
values_fill = NA)
# pivot medhospX_start_dt
out2 <- out %>%
mutate(medhospX_start_dt_names = str_replace('medhospX_start_dt', 'X', redcap_repeat_instance)) %>%
pivot_wider(
id_cols = c(PATIENT_NUM, medhospX_type, redcap_repeat_instance),
names_from = medhospX_start_dt_names,
values_from = medhospX_start_dt,
values_fill = NA)
# pivot medhospX_start_dt
out2 <- out %>%
mutate(medhospX_start_dt_names = str_replace('medhospX_start_dt', 'X', as.character(redcap_repeat_instance))) %>%
pivot_wider(
id_cols = c(PATIENT_NUM, medhospX_type, redcap_repeat_instance),
names_from = medhospX_start_dt_names,
values_from = medhospX_start_dt,
values_fill = NA)
View(out2)
# pivot medhospX_start_dt
out2 <- out %>%
mutate(medhospX_start_dt_names = str_replace('medhospX_start_dt', 'X', as.character(redcap_repeat_instance))) %>%
pivot_wider(
names_from = medhospX_start_dt_names,
values_from = medhospX_start_dt,
values_fill = NA)
View(datadict)
df2 <- df %>%
group_by(PATIENT_NUM) %>%
mutate(datetime = paste0(date, '-', time),
datetime = ymd_hms(datetime)) %>%
group_by(PATIENT_NUM, ECRF_CODE) %>%
summarise(datetime = min(datetime),
Variable...Field.Name = first(Variable...Field.Name)) %>%
ungroup() %>%
mutate(medhospX_type = as.numeric(str_replace(str_replace(ECRF_CODE, '\\...', ''), '^0', ''))) %>%
group_by(PATIENT_NUM, ECRF_CODE) %>%
arrange(as.numeric(ECRF_CODE)) %>%
mutate(redcap_repeat_instance = row_number())  %>%
ungroup() %>%
mutate(medhospX_start_dt = format(datetime, "%m-%d-%Y"))
df2 <- df %>%
group_by(PATIENT_NUM) %>%
mutate(datetime = paste0(date, '-', time),
datetime = ymd_hms(datetime)) %>%
group_by(PATIENT_NUM, ECRF_CODE) %>%
summarise(datetime = min(datetime),
Variable...Field.Name = first(Variable...Field.Name)) %>%
ungroup() %>%
mutate(medhospX_type = as.numeric(str_replace(str_replace(ECRF_CODE, '\\...', ''), '^0', ''))) %>%
group_by(PATIENT_NUM) %>%
arrange(as.numeric(ECRF_CODE)) %>%
mutate(redcap_repeat_instance = row_number())  %>%
ungroup() %>%
mutate(medhospX_start_dt = format(datetime, "%m-%d-%Y"))
df3 <- df2 %>%
mutate(Variable...Field.Name = str_replace(Variable...Field.Name, 'X', as.character(redcap_repeat_instance)))
# pivot variable names
out <- pivot_wider(df3,
id_cols = c(PATIENT_NUM, medhospX_type, medhospX_start_dt, redcap_repeat_instance),
names_from = Variable...Field.Name,
values_from = ECRF_CODE,
values_fill = NA)
# pivot medhospX_start_dt
out2 <- out %>%
mutate(medhospX_start_dt_names = str_replace('medhospX_start_dt', 'X', as.character(redcap_repeat_instance))) %>%
pivot_wider(
names_from = medhospX_start_dt_names,
values_from = medhospX_start_dt,
values_fill = NA)
View(out2)
colnames(out2)
# pivot medhospX_type
out3 <- out %>%
mutate(medhospX_type_names = str_replace('medhospX_type', 'X', as.character(redcap_repeat_instance))) %>%
pivot_wider(
names_from = medhospX_type_names,
values_from = medhospX_type,
values_fill = NA)
colnames(out3)
# pivot medhospX_type
out3 <- out2 %>%
mutate(medhospX_type_names = str_replace('medhospX_type', 'X', as.character(redcap_repeat_instance))) %>%
pivot_wider(
names_from = medhospX_type_names,
values_from = medhospX_type,
values_fill = NA)
View(out3)
write.csv(out[,-1], '../local_ref/redcap_output_medications_before_and_after.csv', row.names = FALSE)
write.csv(out[,-1], '../local_ref/redcap_output_medications_during.csv', row.names = FALSE)
pwd()
getwd()
write.csv(out[,-1], '../local_ref/redcap_output_medications_during.csv', row.names = FALSE)
write.csv(out3[,-1], '../local_ref/redcap_output_medications_during.csv', row.names = FALSE)
write.csv(out3[,-c("PATIENT_NUM", "redcap_repeat_instance")], '../local_ref/redcap_output_medications_during.csv', row.names = FALSE)
write.csv(out3[,-c(PATIENT_NUM, redcap_repeat_instance)], '../local_ref/redcap_output_medications_during.csv', row.names = FALSE)
write.csv(out3[,-c('PATIENT_NUM', 'redcap_repeat_instance')], '../local_ref/redcap_output_medications_during.csv', row.names = FALSE)
write.csv(out3 %>% filter(-PATIENT_NUM, -redcap_repeat_instance)), '../local_ref/redcap_output_medications_during.csv', row.names = FALSE)
write.csv(out3 %>% filter(-PATIENT_NUM, -redcap_repeat_instance), '../local_ref/redcap_output_medications_during.csv', row.names = FALSE)
write.csv(out3 %>% filter(-c(PATIENT_NUM, redcap_repeat_instance)), '../local_ref/redcap_output_medications_during.csv', row.names = FALSE)
?filter
write.csv(out3 %>% select(-PATIENT_NUM, -redcap_repeat_instance)), '../local_ref/redcap_output_medications_during.csv', row.names = FALSE)
write.csv(out3 %>% select(-PATIENT_NUM, -redcap_repeat_instance), '../local_ref/redcap_output_medications_during.csv', row.names = FALSE)
View(out)
View(df3)
length(unique(df3$ECRF_CODE))
length(unique(df3$PATIENT_NUM))
