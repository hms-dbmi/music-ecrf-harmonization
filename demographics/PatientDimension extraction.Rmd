---
title: "Extraction from PatientDimension eCRF"
date: "`r Sys.Date()`"
author: Pierre
output:
---

```{r}
library( dplyr )
```



1) Downloading the Patient Dimension table and extraction of the desired values (birth date / age / language / zip code / patient num)

```{r}

Patient_dimension_table <- read.delim("example_patient_dimension.txt")

Usefull_Patient_table <-Patient_dimension_table %>%
  select(PATIENT_NUM, AGE_IN_YEARS_NUM, BIRTH_DATE, LANGUAGE_CD, ZIP_CD)


```


Display the dictionary relevant to the demographic eCRF

```{r}
data_dictionnary <- read.csv("MUSIC_DataDictionary_V3_4Dec20_final version_clean_0.csv")%>%
  filter(Form.Name=="demographics")
  View(data_dictionnary) 
```


it_1_admit : dd the "it_1_admit" column based on the age of the patient when it enters the hospital (1 if age <1; 0 if age>1) 
```{r}
Usefull_Patient_table$lt_1_admit <- NA

for (i in 1:dim(Usefull_Patient_table)[1]) {
    if ((Usefull_Patient_table$AGE_IN_YEARS_NUM[i]<1)) {
      Usefull_Patient_table$lt_1_admit[i] <- "1"
    }else{
      Usefull_Patient_table$lt_1_admit[i] <- "0"
    }
}

Usefull_Patient_table$lt_1_admit
```


#### Zipcode ### rename the zipcode colomn 
```{r}
names(Usefull_Patient_table)[names(Usefull_Patient_table) == 'ZIP_CD'] <- 'zipcodeus'

```

Country :  Fill the country column (contry 1, US | 2, Canada | 3, Other) 
```{r}
 Usefull_Patient_table$country <- NA
 
for (i in 1:dim(Usefull_Patient_table)[1]) {
    if (is.null(Usefull_Patient_table$zipcodeus[i])) {
      Usefull_Patient_table$country[i] <- NA
    }else{
      Usefull_Patient_table$country[i] <- "1"
    }
}
 Usefull_Patient_table$country

```


Language : add the language field  (1, English | 2, Spanish | 3, Both English and Spanish | 4, Other | 99, Decline to answer) 


```{r}
Usefull_Patient_table$language <- NA
 
for (i in 1:dim(Usefull_Patient_table)[1]) {
    if (Usefull_Patient_table$LANGUAGE_CD[i] == "English") {
      Usefull_Patient_table$language[i]="1"
    } else if(Usefull_Patient_table$LANGUAGE_CD[i] == "Spanish") {
      Usefull_Patient_table$language[i]="2"
    }else{
      Usefull_Patient_table$language[i]="4"
    }
}
 Usefull_Patient_table$language

```



